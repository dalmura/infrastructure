machine:
  nodeLabels:
    k8s.dalmura.cloud/nodegroup: "<K8S_NODE_GROUP>"
    node.kubernetes.io/instance-type: "<NODE_INSTANCE_TYPE>"

  network:
    interfaces:
      - interface: bond0

        bond:
          interfaces:
            - "enp1s0"
            - "enp2s0"
            #- "enx<HW_ADDRESS_P1>"
            #- "enx<HW_ADDRESS_P2>"
          mode: 802.3ad
          lacpRate: fast
          xmitHashPolicy: "layer3+4"
          miimon: 100

        dhcp: true
        dhcpOptions:
          routeMetric: 2048

        vlans:
          - # SERVERS
            vlanId: 103
            dhcp: true
            dhcpOptions:
              routeMetric: 1024

    nameservers:
      - 192.168.77.1
      - 192.168.77.129

  install:
    image: <INSTALLER_IMAGE_URI>

    diskSelector:
      size: '>= 500GB'

  sysctls:
    # Required for Longhorn V2 Data Engine
    vm.nr_hugepages: "1024"

  kernel:
    modules:
      # Required for Longhorn V2 Data Engine
      - name: nvme_tcp
      - name: vfio_pci

      # Required for Plex transcoding
      # 2026-01-01: Commented out for testing, might not be needed
      #- name: i915
      #  parameters:
      #    - "enable_guc=3"

  udev:
    rules:
      # Required for Plex transcoding
      - SUBSYSTEM=="drm", KERNEL=="renderD*", GROUP="44", MODE="0660"
